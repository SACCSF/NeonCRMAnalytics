name: Create Report

on: [ push ]

jobs:
  get-requirements:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Check requirements
        uses: ekvanox/pipreqs-action@master

        with:
          PROJECT_PATH: .
          REQUIREMENT_PATH: ./requirements.txt
          COMMIT_MESSAGE: "Updated requirements.txt"

  report:
    runs-on: ubuntu-latest
    needs: get-requirements
    steps:
    - name: Create envfile
      uses: SpicyPizza/create-envfile@v2.0
      with:
        envkey_DEBUG: false
        API_API_KEY: ${{ secrets.API_API_KEY }}
        API_ORG_ID: ${{ secrets.API_ORG_ID }}
        GOOGLE_MAIL_APPPASSWORD: ${{ secrets.GOOGLE_MAIL_APPPASSWORD }}
        GOOGLE_MAIL_ADDRESS: ${{ secrets.GOOGLE_MAIL_ADDRESS }}
        file_name: .env
        fail_on_empty: false
        sort_keys: false

    - name: Install requirements
      run: pip install -r /requirements.txt
      shell: sh

    - name: Run Report
      run: python ./Report.py
      shell: sh
